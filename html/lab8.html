<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 8: Visualization & Integrated QC - Bioinformatics 2026</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="../index.html" class="logo">Bioinformatics 2026</a>
            <button class="nav-toggle" onclick="toggleNav()">&#9776;</button>
            <ul id="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="labs.html" class="active">Labs</a></li>
                <li><a href="setup.html">Setup</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="breadcrumbs">
            <a href="../index.html">Home</a> / <a href="labs.html">Labs</a> / Lab 8
        </div>

        <div class="lab-header">
            <h1>Lab 8: Visualization & Integrated QC</h1>
            <p class="lab-meta">Day 3 | Duration: 30 minutes</p>
        </div>

        <section>
            <h2>Objectives</h2>
            <ul>
                <li>Create publication-quality volcano plots and heatmaps</li>
                <li>Use seaborn in Python for RNA-seq visualizations</li>
                <li>Aggregate QC reports with MultiQC</li>
                <li>Generate summary visualizations for presentations</li>
            </ul>
        </section>

        <section>
            <h2>Instructions</h2>

            <div class="step" data-step="1">
                <h3>Set up Python environment</h3>
                <pre><code># Navigate to project directory
cd ~/bioinformatics_course

# Activate conda environment
conda activate bioinformatics_course

# Start Python or Jupyter
python3</code></pre>
            </div>

            <div class="step" data-step="2">
                <h3>Load libraries and data</h3>
                <pre><code>import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Set style
sns.set_style("whitegrid")
plt.rcParams['figure.figsize'] = [10, 8]
plt.rcParams['figure.dpi'] = 100

# Load DESeq2 results
de_results = pd.read_csv("results/deseq2_all_results.csv", index_col=0)
print(de_results.head())
print(f"\nTotal genes: {len(de_results)}")</code></pre>
            </div>

            <div class="step" data-step="3">
                <h3>Create a volcano plot</h3>
                <p>Volcano plots show both statistical significance and magnitude of change.</p>
                <pre><code># Add significance column
de_results['significant'] = (de_results['padj'] < 0.05) & \
                           (abs(de_results['log2FoldChange']) > 1)

# Add direction column
de_results['direction'] = 'Not significant'
de_results.loc[(de_results['padj'] < 0.05) &
               (de_results['log2FoldChange'] > 1), 'direction'] = 'Upregulated'
de_results.loc[(de_results['padj'] < 0.05) &
               (de_results['log2FoldChange'] < -1), 'direction'] = 'Downregulated'

# Create volcano plot
plt.figure(figsize=(10, 8))

colors = {'Not significant': 'gray',
          'Upregulated': 'red',
          'Downregulated': 'blue'}

for direction, color in colors.items():
    subset = de_results[de_results['direction'] == direction]
    plt.scatter(subset['log2FoldChange'],
                -np.log10(subset['padj']),
                c=color,
                label=f"{direction} ({len(subset)})",
                alpha=0.6,
                s=20)

plt.xlabel('log2 Fold Change', fontsize=12)
plt.ylabel('-log10(adjusted p-value)', fontsize=12)
plt.title('Volcano Plot: Treatment vs Control', fontsize=14)
plt.legend()
plt.axhline(y=-np.log10(0.05), color='black', linestyle='--', alpha=0.5)
plt.axvline(x=1, color='black', linestyle='--', alpha=0.5)
plt.axvline(x=-1, color='black', linestyle='--', alpha=0.5)

plt.tight_layout()
plt.savefig('results/volcano_plot.png', dpi=300)
plt.show()</code></pre>
            </div>

            <div class="step" data-step="4">
                <h3>Create a heatmap of top DE genes</h3>
                <pre><code># Load normalized counts
norm_counts = pd.read_csv("results/normalized_counts.csv", index_col=0)

# Get top 50 significant genes by adjusted p-value
sig_genes = de_results[de_results['significant']].sort_values('padj').head(50)
top_genes = sig_genes.index.tolist()

# Subset normalized counts
heatmap_data = norm_counts.loc[top_genes]

# Log transform for better visualization
heatmap_data_log = np.log2(heatmap_data + 1)

# Z-score normalize across samples
heatmap_data_zscore = (heatmap_data_log.T - heatmap_data_log.mean(axis=1)) / \
                       heatmap_data_log.std(axis=1)
heatmap_data_zscore = heatmap_data_zscore.T

# Create heatmap
plt.figure(figsize=(10, 14))
sns.heatmap(heatmap_data_zscore,
            cmap='RdBu_r',
            center=0,
            xticklabels=True,
            yticklabels=True,
            cbar_kws={'label': 'Z-score'})

plt.title('Top 50 Differentially Expressed Genes', fontsize=14)
plt.xlabel('Samples', fontsize=12)
plt.ylabel('Genes', fontsize=12)
plt.tight_layout()
plt.savefig('results/heatmap_top_genes.png', dpi=300)
plt.show()</code></pre>
            </div>

            <div class="step" data-step="5">
                <h3>Create boxplots for specific genes</h3>
                <pre><code># Select a few genes of interest
genes_of_interest = top_genes[:6]

# Prepare data for boxplot
plot_data = []
sample_info = {'sample1': 'Control', 'sample2': 'Control', 'sample3': 'Control',
               'sample4': 'Treatment', 'sample5': 'Treatment', 'sample6': 'Treatment'}

for gene in genes_of_interest:
    for sample in norm_counts.columns:
        plot_data.append({
            'Gene': gene,
            'Sample': sample,
            'Condition': sample_info.get(sample, 'Unknown'),
            'Expression': np.log2(norm_counts.loc[gene, sample] + 1)
        })

plot_df = pd.DataFrame(plot_data)

# Create boxplots
fig, axes = plt.subplots(2, 3, figsize=(14, 10))
axes = axes.flatten()

for i, gene in enumerate(genes_of_interest):
    gene_data = plot_df[plot_df['Gene'] == gene]
    sns.boxplot(x='Condition', y='Expression', data=gene_data, ax=axes[i])
    sns.stripplot(x='Condition', y='Expression', data=gene_data,
                  ax=axes[i], color='black', alpha=0.7)
    axes[i].set_title(gene)
    axes[i].set_ylabel('log2(Normalized Count + 1)')

plt.tight_layout()
plt.savefig('results/gene_boxplots.png', dpi=300)
plt.show()</code></pre>
            </div>

            <div class="step" data-step="6">
                <h3>Sample correlation heatmap</h3>
                <pre><code># Calculate sample correlations
correlation_matrix = norm_counts.corr(method='spearman')

# Create correlation heatmap
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix,
            annot=True,
            fmt='.3f',
            cmap='viridis',
            vmin=0.9,
            vmax=1.0,
            square=True)

plt.title('Sample Correlation (Spearman)', fontsize=14)
plt.tight_layout()
plt.savefig('results/sample_correlation.png', dpi=300)
plt.show()</code></pre>
            </div>

            <div class="step" data-step="7">
                <h3>Run MultiQC for integrated QC report</h3>
                <p>MultiQC aggregates results from multiple bioinformatics tools into a single report.</p>
                <pre><code># Exit Python first, then run in terminal
exit()

# Run MultiQC on all QC reports
multiqc \
    qc_reports/ \
    alignment/*Log.final.out \
    counts/*summary \
    -o multiqc_report \
    -n multiqc_report

# Open the report
open multiqc_report/multiqc_report.html</code></pre>
            </div>

            <div class="step" data-step="8">
                <h3>Understanding MultiQC output</h3>
                <p>MultiQC creates an interactive HTML report with sections for each tool:</p>
                <ul>
                    <li><strong>FastQC:</strong> Sequence quality, GC content, adapter content</li>
                    <li><strong>STAR:</strong> Alignment rates, mapping statistics</li>
                    <li><strong>featureCounts:</strong> Assignment rates, gene coverage</li>
                </ul>

                <div class="info-box tip">
                    <strong>Using MultiQC effectively</strong>
                    <ul>
                        <li>Look for outlier samples in each metric</li>
                        <li>Compare samples across all QC metrics</li>
                        <li>Export plots for presentations and publications</li>
                        <li>Use the "Configure Columns" feature to customize tables</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Summary</h2>
            <p>In this lab, you learned to:</p>
            <ul>
                <li>Create volcano plots to visualize differential expression</li>
                <li>Generate heatmaps of top differentially expressed genes</li>
                <li>Make boxplots comparing gene expression across conditions</li>
                <li>Calculate and visualize sample correlations</li>
                <li>Use MultiQC to aggregate and visualize QC metrics</li>
            </ul>
        </section>

        <section>
            <h2>Next Steps</h2>
            <p>In <a href="lab9.html">Lab 9</a>, we will perform pathway and enrichment analysis to interpret the biological meaning of our differential expression results.</p>
        </section>
    </main>

    <footer>
        <p>Bioinformatics Specialization Program 2026</p>
    </footer>

    <script>
        function toggleNav() {
            document.getElementById('nav-menu').classList.toggle('show');
        }
    </script>
</body>
</html>
