<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 4: Quality Control Hands-on - Bioinformatics 2026</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="../index.html" class="logo">Bioinformatics Specialization Program - KAUST Academy</a>
            <button class="nav-toggle" onclick="toggleNav()">&#9776;</button>
            <ul id="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="labs.html" class="active">Labs</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="setup.html">Setup</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="breadcrumbs">
            <a href="../index.html">Home</a> / <a href="labs.html">Labs</a> / Lab 4
        </div>

        <div class="lab-header">
            <h1>Lab 4: Quality Control Hands-on</h1>
            <p class="lab-meta">Day 2 | Duration: 45 minutes</p>
        </div>

        <section>
            <h2>Objectives</h2>
            <ul>
                <li>Apply quality trimming to remove low-quality bases</li>
                <li>Remove adapter sequences from reads</li>
                <li>Compare pre- and post-QC metrics to verify improvements</li>
                <li>Understand when and how much to trim</li>
            </ul>
        </section>

        <section>
            <h2>Background</h2>
            <p>After identifying quality issues in Lab 3, we now apply preprocessing steps to improve data quality. The goal is to remove low-quality bases and adapter contamination while retaining as much useful data as possible. We will use multiple tools:</p>
            <ul>
                <li><strong>Trim Galore:</strong> Wrapper around Cutadapt with sensible defaults</li>
                <li><strong>fastp:</strong> All-in-one tool for filtering and trimming</li>
                <li><strong>Cutadapt:</strong> Specialized adapter trimming tool</li>
            </ul>
        </section>

        <section>
            <h2>Instructions</h2>

            <div class="step" data-step="1">
                <h3>Set up your environment</h3>
                <pre><code># Navigate to project directory
cd ~/bioinformatics_course

# Activate conda environment
conda activate bioinformatics_course

# Create output directory
mkdir -p trimmed_data</code></pre>
            </div>

            <div class="step" data-step="2">
                <h3>Method 1: Trim Galore (Recommended)</h3>
                <p>Trim Galore automatically detects adapter sequences and applies quality trimming.</p>
                <pre><code># Run Trim Galore on paired-end data
trim_galore \
    --paired \
    --quality 20 \
    --length 36 \
    --fastqc \
    --output_dir trimmed_data \
    raw_data/sample_1.fastq.gz \
    raw_data/sample_2.fastq.gz

# Parameters explained:
# --paired: Input files are paired-end
# --quality 20: Trim bases with quality below Q20
# --length 36: Discard reads shorter than 36 bp after trimming
# --fastqc: Run FastQC on trimmed files automatically</code></pre>
                <div class="info-box note">
                    <strong>Note</strong>
                    Trim Galore automatically detects Illumina adapter sequences. For other platforms, you may need to specify adapters manually.
                </div>
            </div>

            <div class="step" data-step="3">
                <h3>Method 2: fastp (Faster alternative)</h3>
                <p>fastp performs adapter trimming, quality filtering, and generates reports in one step.</p>
                <pre><code># Run fastp on paired-end data
fastp \
    -i raw_data/sample_1.fastq.gz \
    -I raw_data/sample_2.fastq.gz \
    -o trimmed_data/sample_fastp_1.fastq.gz \
    -O trimmed_data/sample_fastp_2.fastq.gz \
    --qualified_quality_phred 20 \
    --length_required 36 \
    --detect_adapter_for_pe \
    --html trimmed_data/sample_fastp_report.html \
    --json trimmed_data/sample_fastp_report.json \
    --thread 4

# Parameters explained:
# --qualified_quality_phred 20: Quality threshold
# --length_required 36: Minimum read length
# --detect_adapter_for_pe: Auto-detect adapters for paired-end</code></pre>
            </div>

            <div class="step" data-step="4">
                <h3>Method 3: Cutadapt (Fine-grained control)</h3>
                <p>Cutadapt offers precise control over adapter trimming parameters.</p>
                <pre><code># Define adapter sequences (Illumina TruSeq)
ADAPTER_FWD="AGATCGGAAGAGCACACGTCTGAACTCCAGTCA"
ADAPTER_REV="AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT"

# Run Cutadapt
cutadapt \
    -a $ADAPTER_FWD \
    -A $ADAPTER_REV \
    -q 20 \
    -m 36 \
    -o trimmed_data/sample_cutadapt_1.fastq.gz \
    -p trimmed_data/sample_cutadapt_2.fastq.gz \
    raw_data/sample_1.fastq.gz \
    raw_data/sample_2.fastq.gz

# Parameters:
# -a/-A: Adapter sequences for read 1/2
# -q: Quality trimming threshold
# -m: Minimum length after trimming</code></pre>
            </div>

            <div class="step" data-step="5">
                <h3>Compare pre- and post-trimming quality</h3>
                <p>Run FastQC on trimmed data and compare with original reports.</p>
                <pre><code># Run FastQC on trimmed files
mkdir -p qc_reports/fastqc_trimmed
fastqc trimmed_data/*_val_*.fq.gz -o qc_reports/fastqc_trimmed -t 4

# Compare file sizes (trimmed should be smaller)
echo "Raw data sizes:"
ls -lh raw_data/*.fastq.gz

echo "Trimmed data sizes:"
ls -lh trimmed_data/*_val_*.fq.gz</code></pre>
            </div>

            <div class="step" data-step="6">
                <h3>Analyze trimming statistics</h3>
                <p>Review trimming reports to understand what was removed.</p>
                <pre><code># View Trim Galore report
cat trimmed_data/*_trimming_report.txt

# Key metrics to check:
# - Total reads processed
# - Reads with adapters found
# - Reads removed due to length
# - Base pairs quality-trimmed

# For fastp, check the JSON report
python3 << 'EOF'
import json
with open('trimmed_data/sample_fastp_report.json') as f:
    data = json.load(f)

before = data['summary']['before_filtering']
after = data['summary']['after_filtering']

print("=== Trimming Summary ===")
print(f"Reads before: {before['total_reads']:,}")
print(f"Reads after: {after['total_reads']:,}")
print(f"Reads removed: {before['total_reads'] - after['total_reads']:,}")
print(f"Q30 before: {before['q30_rate']:.2%}")
print(f"Q30 after: {after['q30_rate']:.2%}")
EOF</code></pre>
            </div>

            <div class="step" data-step="7">
                <h3>Best practices for trimming</h3>
                <div class="info-box tip">
                    <strong>Trimming Guidelines</strong>
                    <ul>
                        <li>Use Q20 as a reasonable quality threshold for most applications</li>
                        <li>Set minimum length based on your downstream analysis (36-50 bp typical)</li>
                        <li>Don't over-trim: losing too many reads can hurt analysis</li>
                        <li>For RNA-seq, adapter trimming is essential; quality trimming is often less critical</li>
                        <li>Always verify improvements with post-trimming QC</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>Summary</h2>
            <p>In this lab, you learned to:</p>
            <ul>
                <li>Apply quality and adapter trimming using multiple tools</li>
                <li>Choose appropriate trimming parameters</li>
                <li>Compare pre- and post-trimming quality metrics</li>
                <li>Interpret trimming statistics</li>
            </ul>
        </section>

        <section>
            <h2>Next Steps</h2>
            <p>In <a href="lab5.html">Lab 5</a>, we will align our cleaned reads to a reference genome using STAR.</p>
        </section>
    </main>

    <footer>
        <p>Bioinformatics Specialization Program 2026 - KAUST Academy</p>
    </footer>

    <script>
        function toggleNav() {
            document.getElementById('nav-menu').classList.toggle('show');
        }
    </script>
</body>
</html>
